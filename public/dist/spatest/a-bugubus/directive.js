app.directive("focusAuto",function(){return{link:function(scope,element){element[0].id="J_focus_auto_"+(new Date).getTime(),document.body.addEventListener("touchstart",function(e){e.target.id!=element[0].id&&element[0].blur()}),element[0].focus()}}}),app.directive("barcode",function(){return{link:function(scope,element,attrs){var id="J_barcode"+(new Date).getTime();element[0].id=id,JsBarcode("#"+id,scope.$parent.$eval(attrs.ngModel)),scope.$watch(attrs.ngModel,function(newValue){JsBarcode("#"+id,newValue)})}}}),app.filter("transfer",function(){return function(input,fieldName){if(void 0!=fieldName){var dict={sex:{0:"男",1:"女"},ticketStatus:{0:"车票已过期",1:"车票有效"}};return dict[fieldName][input]}alert("变量名称不能为空")}}),app.directive("touch",function(){return{link:function($scope,element){var startX,moveX,dom=element[0];dom.addEventListener("touchstart",function(e){dom&&(startX=e.targetTouches[0].pageX)}),dom.addEventListener("touchmove",function(e){var targetMarginLeft=dom.style.marginLeft.replace("px","");moveX=e.changedTouches[0].pageX,targetMarginLeft>=0&&0>startX-moveX||(targetMarginLeft>=-80&&0>startX-moveX?dom.style.marginLeft=-(startX-moveX)-80+"px":targetMarginLeft>-80&&(dom.style.marginLeft=startX-moveX>=80?"-80px":-(startX-moveX)+"px"))}),dom.addEventListener("touchend",function(e){var endX=e.changedTouches[0].pageX;if(startX-endX>30)var interval=setInterval(function(){var targetMarginLeft=dom.style.marginLeft.replace("px","");if(targetMarginLeft>-80){var temp=--targetMarginLeft;dom.style.marginLeft=--temp+"px"}else clearInterval(interval),dom.style.marginLeft="-80px"},2);else var interval=setInterval(function(){var targetMarginLeft=dom.style.marginLeft.replace("px","");if(0>targetMarginLeft){var temp=++targetMarginLeft;dom.style.marginLeft=++temp+"px"}else clearInterval(interval),dom.style.marginLeft=-0+"px"},2)})}}}),app.directive("xinxin",function(){return{link:function($scope,element){var startX,dom=element[0];dom.addEventListener("touchstart",function(e){dom&&(startX=e.targetTouches[0].pageX)})}}}),app.directive("selectcity",function(){return{restrict:"AE",template:'<div  style="position: absolute;z-index: 4;top: 44px;left: -1px"><i style="position: absolute;left:20px;top:-10px;width: 0;height: 0;border-left: 10px solid transparent;border-right: 10px solid transparent;border-bottom: 14px solid #ffffff;"></i><div style="background-color: #ffffff;border-radius: 4px;min-width: 60px;">贵阳市</div></div>',replace:!0,link:function($scope,element){$scope.city={cityname:"贵州市"};var dom=element[0];dom.addEventListener("touchend",function(){dom&&($scope.city.cityname!=$scope.positionCity?($scope.check=!0,$scope.positionCity=$scope.city.cityname):$scope.check=!0)})}}}),app.directive("qrcode",function(){var directive={restrict:"EA",replace:!0,scope:{infostr:"@"},template:'<div id="qrcode"></div>',link:function($scope){!function($){var q=$("#qrcode"),draw=function(){var option={height:100,width:100,text:$scope.infostr};new QRCode(q,option)};draw()}(document.querySelector.bind(document))}};return directive}),app.directive("star",function(){return{template:'<ul class="rating" ng-mouseleave="leave()"><li ng-repeat="star in stars" ng-class="star" ng-click="click($index + 1)" ng-mouseover="over($index + 1)">★</li></ul>',scope:{ratingValue:"=",max:"=",readonly:"@",onHover:"=",onLeave:"="},controller:function($scope){$scope.ratingValue=$scope.ratingValue||0,$scope.max=$scope.max||5,$scope.click=function(val){$scope.readonly&&"true"===$scope.readonly||($scope.ratingValue=val)},$scope.over=function(val){$scope.onHover(val)},$scope.leave=function(){$scope.onLeave()}},link:function(scope){var updateStars=function(){scope.stars=[];for(var i=0;i<scope.max;i++)scope.stars.push({filled:i<scope.ratingValue})};updateStars(),scope.$watch("ratingValue",function(oldVal){oldVal&&updateStars()}),scope.$watch("max",function(oldVal,newVal){newVal&&updateStars()})}}}),app.directive("my-ng-model",function(){var directive={restrict:"A",require:"?ngModel",link:function(scope,element,attrs,ngModel){function readViewText(){var html=element.html();attrs.stripBr&&"<br>"===html&&(html=""),ngModel.$setViewValue(html)}ngModel&&(ngModel.$render=function(){element.html(ngModel.$viewValue||"")},element.on("blur keyup change",function(){scope.$apply(readViewText)}))}};return directive}),app.directive("enlargePic",function(){return{restrict:"AE",link:function(scope,elem,attrs){elem.bind("click",function(){angular.element(document.querySelector(".mask"))[0].style.display="block",angular.element(document.querySelector(".bigPic"))[0].src=attrs.src})}}}),app.directive("closePic",function(){return{restrict:"AE",link:function(scope,elem){elem.bind("click",function(){angular.element(document.querySelector(".mask"))[0].style.display="none"})}}}),app.directive("errSrc",function(){return{link:function(scope,element,attrs){element.bind("error",function(){attrs.src!=attrs.errSrc&&attrs.$set("src",attrs.errSrc)})}}}),app.directive("loadinganimation",function(){var directive={restrict:"EA",replace:!0,scope:{infostr:"@"},template:'<div id="loader">    <div id="lemon" style="transition: all linear 1s;"></div>    <div id="straw" style="transition: all linear 1s;"></div>    <div id="glass">        <div id="cubes">            <div style="transition: all linear 1s;" ></div>            <div style="transition: all linear 1s;"></div>            <div style="transition: all linear 1s;"></div>        </div>        <div id="drink" style="transition: all linear .5s;"></div>        <span id="counter"></span>    </div>    <div id="coaster"></div></div>',link:function($scope,element){function increment(){count%2==1?(1==count&&angular.element(angular.element(element.children()[2]).children()[2]).html(loaded+"%"),angular.element(angular.element(element.children()[2]).children()[1]).css("top",100-.89*loaded+"%"),25==loaded&&angular.element(angular.element(angular.element(element.children()[2]).children()[0]).children()[0]).css("opacity","1"),50==loaded&&angular.element(angular.element(angular.element(element.children()[2]).children()[0]).children()[1]).css("opacity","1"),75==loaded&&angular.element(angular.element(angular.element(element.children()[2]).children()[0]).children()[2]).css("opacity","1"),100==loaded?(angular.element(element.children()[0]).css("opacity","1"),angular.element(element.children()[1]).css("opacity","1"),loaded=11,stopLoading(),setTimeout(startLoading,1e3),count++):loaded++):(1!=count&&angular.element(angular.element(element.children()[2]).children()[2]).html(""),angular.element(angular.element(element.children()[2]).children()[1]).css("top",.89*loaded+"%"),25==loaded&&angular.element(angular.element(angular.element(element.children()[2]).children()[0]).children()[2]).css("opacity","0"),50==loaded&&angular.element(angular.element(angular.element(element.children()[2]).children()[0]).children()[1]).css("opacity","0"),75==loaded&&angular.element(angular.element(angular.element(element.children()[2]).children()[0]).children()[0]).css("opacity","0"),100==loaded?(angular.element(element.children()[0]).css("opacity","0"),angular.element(element.children()[1]).css("opacity","0"),loaded=10,stopLoading(),setTimeout(startLoading,1e3),count++):loaded++)}function startLoading(){count%2==1?(angular.element(element.children()[0]).css("opacity","0"),angular.element(element.children()[1]).css("opacity","0"),angular.element(angular.element(element.children()[2]).children()[0]).children().css("opacity","0")):(angular.element(element.children()[0]).css("opacity","1"),angular.element(element.children()[1]).css("opacity","1"),angular.element(angular.element(element.children()[2]).children()[0]).children().css("opacity","1")),worker=setInterval(increment,60)}function stopLoading(){clearInterval(worker)}console.log(angular.element(angular.element(element.children()[2]).children()[0]).children());var worker=null,loaded=0,count=1;startLoading()}};return directive}),app.directive("myTag",function(){var directive={restrict:"A",replace:!0,template:'<div class="btnfont"><span ng-repeat="t in tags track by $index" class="{{tag(t)}}">{{t}}</span></div>',scope:{myTags:"="},link:function(scope){scope.tags=scope.myTags.split("&"),scope.tag=function(t){switch(t){case"单程":return"btnfontgreen";case"单程 + 门票":return"btnfontgreen";case"往返":return"btnfontorange";case"往返+门票":return"btnfontorange";case"门票":return"btnfontblue";default:return"btnfontred"}}}};return directive});