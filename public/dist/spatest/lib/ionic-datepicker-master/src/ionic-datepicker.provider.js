angular.module("ionic-datepicker.provider",[]).provider("ionicDatePicker",function(){var config={titleLabel:null,setLabel:"Set",todayLabel:"Today",closeLabel:"Close",inputDate:new Date,mondayFirst:!0,weeksList:["S","M","T","W","T","F","S"],monthsList:["Jan","Feb","March","April","May","June","July","Aug","Sept","Oct","Nov","Dec"],templateType:"popup",showTodayButton:!1,closeOnSelect:!1,disableWeekdays:[]};this.configDatePicker=function(inputObj){angular.extend(config,inputObj)},this.$get=["$rootScope","$ionicPopup","$ionicModal","IonicDatepickerService",function($rootScope,$ionicPopup,$ionicModal,IonicDatepickerService){function resetHMSM(currentDate){return currentDate.setHours(0),currentDate.setMinutes(0),currentDate.setSeconds(0),currentDate.setMilliseconds(0),currentDate}function setDisabledDates(mainObj){mainObj.disabledDates&&0!==mainObj.disabledDates.length?($scope.disabledDates=[],angular.forEach(mainObj.disabledDates,function(val){val=resetHMSM(new Date(val)),$scope.disabledDates.push(val.getTime())})):$scope.disabledDates=[]}function refreshDateList(currentDate){currentDate=resetHMSM(currentDate),$scope.currentDate=angular.copy(currentDate);var firstDay=new Date(currentDate.getFullYear(),currentDate.getMonth(),1).getDate(),lastDay=new Date(currentDate.getFullYear(),currentDate.getMonth()+1,0).getDate();$scope.monthsList=[],$scope.monthsList=$scope.mainObj.monthsList&&12===$scope.mainObj.monthsList.length?$scope.mainObj.monthsList:IonicDatepickerService.monthsList,$scope.yearsList=IonicDatepickerService.getYearsList($scope.mainObj.from,$scope.mainObj.to),$scope.dayList=[];var tempDate,disabled;$scope.firstDayEpoch=resetHMSM(new Date(currentDate.getFullYear(),currentDate.getMonth(),firstDay)).getTime(),$scope.lastDayEpoch=resetHMSM(new Date(currentDate.getFullYear(),currentDate.getMonth(),lastDay)).getTime();for(var i=firstDay;lastDay>=i;i++)tempDate=new Date(currentDate.getFullYear(),currentDate.getMonth(),i),disabled=tempDate.getTime()<$scope.fromDate||tempDate.getTime()>$scope.toDate||$scope.mainObj.disableWeekdays.indexOf(tempDate.getDay())>=0,$scope.dayList.push({date:tempDate.getDate(),month:tempDate.getMonth(),year:tempDate.getFullYear(),day:tempDate.getDay(),epoch:tempDate.getTime(),disabled:disabled});var firstDayMonday=$scope.dayList[0].day-$scope.mainObj.mondayFirst;firstDayMonday=0>firstDayMonday?6:firstDayMonday;for(var j=0;firstDayMonday>j;j++)$scope.dayList.unshift({});$scope.rows=[0,7,14,21,28,35],$scope.cols=[0,1,2,3,4,5,6],$scope.data.currentMonth=$scope.mainObj.monthsList[currentDate.getMonth()],$scope.data.currentYear=currentDate.getFullYear(),$scope.data.currentMonthSelected=angular.copy($scope.data.currentMonth),$scope.currentYearSelected=angular.copy($scope.data.currentYear),$scope.numColumns=7}function setInitialObj(ipObj){$scope.mainObj=angular.copy(ipObj),$scope.selctedDateEpoch=resetHMSM($scope.mainObj.inputDate).getTime(),$scope.weeksList=$scope.mainObj.weeksList&&7===$scope.mainObj.weeksList.length?$scope.mainObj.weeksList:["S","M","T","W","T","F","S"],$scope.mainObj.mondayFirst&&$scope.weeksList.push($scope.mainObj.weeksList.shift()),$scope.disableWeekdays=$scope.mainObj.disableWeekdays,refreshDateList($scope.mainObj.inputDate),setDisabledDates($scope.mainObj)}function openModal(){$scope.modal.show()}function closeModal(){$scope.modal.hide()}var provider={},$scope=$rootScope.$new();$scope.today=resetHMSM(new Date).getTime(),$scope.disabledDates=[],$scope.data={},$scope.prevMonth=function(){1===$scope.currentDate.getMonth()&&$scope.currentDate.setFullYear($scope.currentDate.getFullYear()),$scope.currentDate.setMonth($scope.currentDate.getMonth()-1),$scope.data.currentMonth=$scope.mainObj.monthsList[$scope.currentDate.getMonth()],$scope.data.currentYear=$scope.currentDate.getFullYear(),refreshDateList($scope.currentDate),changeDaySelected()},$scope.nextMonth=function(){11===$scope.currentDate.getMonth()&&$scope.currentDate.setFullYear($scope.currentDate.getFullYear()),$scope.currentDate.setDate(1),$scope.currentDate.setMonth($scope.currentDate.getMonth()+1),$scope.data.currentMonth=$scope.mainObj.monthsList[$scope.currentDate.getMonth()],$scope.data.currentYear=$scope.currentDate.getFullYear(),$scope.monthChanged($scope.currentDate.getMonth()),refreshDateList(new Date),changeDaySelected()};var changeDaySelected=function(){var newSelectedDate=new Date($scope.selctedDateEpoch);newSelectedDate.setMonth($scope.currentDate.getMonth()),newSelectedDate.setYear($scope.currentDate.getFullYear()),$scope.selctedDateEpoch=newSelectedDate.getTime(),$scope.mainObj.callback($scope.selctedDateEpoch)};return $scope.dateSelected=function(selectedDate){selectedDate&&0!==Object.keys(selectedDate).length&&($scope.selctedDateEpoch=selectedDate.epoch,$scope.mainObj.closeOnSelect&&($scope.mainObj.callback($scope.selctedDateEpoch),"popup"==$scope.mainObj.templateType.toLowerCase()?$scope.popup.close():closeModal()))},$scope.setIonicDatePickerTodayDate=function(){$scope.dateSelected($scope.today)},$scope.setIonicDatePickerDate=function(){$scope.mainObj.callback($scope.selctedDateEpoch),closeModal()},$scope.monthChanged=function(month){var monthNumber=$scope.monthsList.indexOf(month);$scope.currentDate.setMonth(monthNumber),refreshDateList($scope.currentDate),changeDaySelected()},$scope.yearChanged=function(year){$scope.currentDate.setFullYear(year),refreshDateList($scope.currentDate),changeDaySelected()},$ionicModal.fromTemplateUrl("ionic-datepicker-modal.html",{scope:$scope,animation:"slide-in-up"}).then(function(modal){$scope.modal=modal}),$scope.$on("$destroy",function(){$scope.modal.remove()}),$scope.closeIonicDatePickerModal=function(){closeModal()},provider.openDatePicker=function(ipObj){var buttons=[];delete $scope.fromDate,delete $scope.toDate,$scope.mainObj=angular.extend({},config,ipObj),$scope.mainObj.from&&($scope.fromDate=resetHMSM(new Date($scope.mainObj.from)).getTime()),$scope.mainObj.to&&($scope.toDate=resetHMSM(new Date($scope.mainObj.to)).getTime()),ipObj.disableWeekdays&&config.disableWeekdays&&($scope.mainObj.disableWeekdays=ipObj.disableWeekdays.concat(config.disableWeekdays)),setInitialObj($scope.mainObj),$scope.mainObj.closeOnSelect||(buttons=[{text:$scope.mainObj.setLabel,type:"button_set",onTap:function(){$scope.mainObj.callback($scope.selctedDateEpoch)}}]),$scope.mainObj.showTodayButton&&buttons.push({text:$scope.mainObj.todayLabel,type:"button_today",onTap:function(e){var today=new Date($scope.today),today_obj={date:today.getDate(),month:today.getMonth(),year:today.getFullYear(),day:today.getDay(),epoch:today.getTime(),disabled:!1};$scope.dateSelected(today_obj),refreshDateList(new Date),$scope.selctedDateEpoch=resetHMSM(today).getTime(),$scope.mainObj.callback($scope.selctedDateEpoch),$scope.mainObj.closeOnSelect||e.preventDefault()}}),buttons.push({text:$scope.mainObj.closeLabel,type:"button_close",onTap:function(){}}),"popup"==$scope.mainObj.templateType.toLowerCase()?$scope.popup=$ionicPopup.show({templateUrl:"ionic-datepicker-popup.html",scope:$scope,cssClass:"ionic_datepicker_popup",buttons:buttons}):openModal()},provider}]});